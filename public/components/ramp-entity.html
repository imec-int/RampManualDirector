<link rel="import" href="bower_components/polymer/polymer.html">

<!--
Element providing solution to no problem in particular.

##### Example

    <ramp-entity></ramp-entity>

@element ramp-entity
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://RobbyWauters.github.io/ramp-entity
-->
<polymer-element name="ramp-entity" attributes="type x y direction active lookTo w h">

  <template>
    <link rel="stylesheet" href="ramp-entity.css" />

    <content>
      <div class="entity" data-type="{{type}}">
        <div id="handle" class="handle">
          <img id="img" src="/images/{{imgName}}.png" />
        </div>
        <div id="sizeTool" class="total-centered">
          <span>{{w}}</span>x<span>{{h}}</span>
        </div>
        <span class="cornerLabel">[{{x}},{{y}}] {{console}}</span>
      </div>
    </content>

  </template>

  <script>

    Polymer('ramp-entity', {

      type: "chair",
      x: 0,
      y: 0,
      w: 1,
      h: 1,
      sizeTool: false,
      console: "",
      active: false,
      imgName: "chair",
      direction: "down",

      ready: function() {
        var self = this;

        // POSITIONING
        $(this).css({
          "left": this.x*64,
          "top" : this.y*64
        });



        //SIZETOOL (table)
        $(this.$.sizeTool).hide();

        // IMAGE
        this.imgName = "";
        switch(this.type){
          case "chairman":
            this.imgName = "chairman_chair";
            break;
          case "member":
            this.imgName = "chair";
            break;
          case "table":
            this.imgName = "table";
            this.sizeTool = true;
            break;
          case "dj":
            this.imgName = "stool";
            break;
          case "booth":
            this.imgName = "booth";
            break;
        }

        // DRAGGING
        var draggie = new Draggabilly( this, {
          containment: '#topView',
          grid: [ 64, 64 ]
        });

        draggie.on( 'dragMove', function(){
          self.move.call(self);
        } );

        // $(this).on('click', function(ev){
        //   console.log(ev);
        //   self.w++;
        // });

        // console.log($(this.$.sizeTool).find("#sizeRight").first());

        // CLICKING
        // $(this).on('click', function(){
        //   self.active = !self.active;
        //   if(self.active){
        //     $(this).css("background-color", "rgba(255, 199, 199, 1)" );
        //   }else{
        //     $(this).css("background-color", "rgba(255, 199, 199, 0)" );
        //   }
        // });
      },

      move: function() {
        this.x = Math.floor($(this).position().left/64);
        this.y = Math.floor($(this).position().top/64);
      },

      directionChanged: function(oldVal, newVal){
        $(this.$.img).removeClass();
        switch(newVal){
          case "up":
            $(this.$.img).addClass('lookUp');
            break;
          case "right":
            $(this.$.img).addClass('lookRight');
            break;
          case "down":
            $(this.$.img).addClass('lookDown');
            break;
          case "left":
            $(this.$.img).addClass('lookLeft');
            break;
        }
      },

      wChanged: function(oldVal, newVal){
        $(this.$.img).css("width",this.w*64+"px");
        $(this.$.img).css("height",this.h*64+"px");
      },
      hChanged: function(oldVal, newVal){
        $(this.$.img).css("width",this.w*64+"px");
        $(this.$.img).css("height",this.h*64+"px");
      },
      sizeToolChanged: function(oldVal, newVal){
        $(this.$.sizeTool).hide();
        if(newVal)
          $(this.$.sizeTool).show();
      },

    });

  </script>

</polymer-element>
